{% extends "dashboard_base.html" %}
{% load static %}

{% block sidebar_title %}Client Menu{% endblock %}
{% block sidebar_menu %}
<li><a href="{% url 'accounts:client_dashboard' %}">Overview</a></li>
<li><a href="{% url 'accounts:client_today' %}">Todays plan</a></li>
<li><a href="{% url 'accounts:client_programme_library' %}">Programme library</a></li>
<li><a href="{% url 'accounts:client_workout_log' %}">Workout log</a></li>
<li><a href="{% url 'accounts:client_metrics' %}" class="is-active">Body metrics</a></li>
<li><a href="{% url 'accounts:client_check_ins' %}">Check-ins</a></li>
<li><a href="{% url 'accounts:client_documents' %}">Documents</a></li>
<li><a href="{% url 'accounts:client_support' %}">Support</a></li>
{% endblock %}

{% block page_eyebrow %}Client dashboard{% endblock %}
{% block page_title %}Body metrics{% endblock %}

{% block dashboard_content %}

<!-- Trend placeholders -->
<section class="dashboard-card dashboard-card--wide">
    <div class="metrics-trend-grid">
        <div class="metrics-trend-card">
            <h2 class="card-title">Bodyweight trend</h2>
            <p class="card-subtitle">Weekly average, based on recent check-ins.</p>
            <div class="chart-placeholder">Chart placeholder</div>
        </div>
        <div class="metrics-trend-card">
            <h2 class="card-title">Strength trend</h2>
            <p class="card-subtitle">Top sets (for example, Bench).</p>
            <div class="chart-placeholder">Chart placeholder</div>
        </div>
    </div>
</section>

<!-- Add check-in + recent entries -->
<section class="dashboard-card dashboard-card--wide">
    <header class="card-header">
        <h2 class="card-title">Add body metrics check-in</h2>
        <p class="card-subtitle">
            Log the latest measurements for bodyweight, waist, strength, and sleep.
        </p>
    </header>

    <div class="card-body">
        <form method="post" class="metrics-form">
            {% csrf_token %}

            <div class="form-field">
                {{ form.date.label_tag }}
                {{ form.date }}
            </div>

            <div class="metrics-grid">
                <div class="form-field">
                    {{ form.bodyweight_kg.label_tag }}
                    {{ form.bodyweight_kg }}
                </div>
                <div class="form-field">
                    {{ form.waist_cm.label_tag }}
                    {{ form.waist_cm }}
                </div>
                <div class="form-field">
                    {{ form.bench_top_set_kg.label_tag }}
                    {{ form.bench_top_set_kg }}
                </div>
                <div class="form-field">
                    {{ form.sleep_hours.label_tag }}
                    {{ form.sleep_hours }}
                </div>
            </div>

            <div class="form-field">
                {{ form.notes.label_tag }}
                {{ form.notes }}
            </div>

            <button type="submit" class="btn btn-primary">
                Save check-in
            </button>
        </form>
    </div>

    {% if recent_entries %}
    <div class="card-footer">
        <h3 class="card-footer-title">Recent check-ins</h3>
        <table class="dashboard-table table-compact">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Bodyweight (kg)</th>
                    <th>Waist (cm)</th>
                    <th>Bench top set (kg)</th>
                    <th>Sleep (h)</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in recent_entries %}
                <tr>
                    <td>{{ entry.date|date:"d M Y" }}</td>
                    <td>{{ entry.bodyweight_kg|default:"—" }}</td>
                    <td>{{ entry.waist_cm|default:"—" }}</td>
                    <td>{{ entry.bench_top_set_kg|default:"—" }}</td>
                    <td>{{ entry.sleep_hours|default:"—" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</section>

<!-- Key metrics summary -->
<section class="dashboard-card dashboard-card--wide">
    <header class="card-header">
        <h2 class="card-title">Key metrics</h2>
        <p class="card-subtitle">
            Latest values and approximate change over the last four weeks.
        </p>
    </header>

    <div class="card-body">
        <table class="dashboard-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Latest</th>
                    <th>Change (4 weeks)</th>
                    <th>Target</th>
                </tr>
            </thead>
            <tbody>
                {% for row in summary_rows %}
                <tr>
                    <td>{{ row.label }}</td>
                    <td>
                        {% if row.latest is not None %}
                            {{ row.latest }} {{ row.unit }}
                        {% else %}
                            &mdash;
                        {% endif %}
                    </td>
                    <td>
                        {% if row.change is not None %}
                            {% if row.change > 0 %}+{% endif %}{{ row.change }} {{ row.unit }}
                        {% else %}
                            &mdash;
                        {% endif %}
                    </td>
                    <td>{{ row.target_display }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <footer class="card-footer text-muted">
        Values are calculated from stored check-ins. Change compares the latest entry
        with one recorded approximately four weeks earlier when available.
    </footer>
</section>

{% endblock %}
