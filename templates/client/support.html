{% extends "dashboard_base.html" %}

{% block page_eyebrow %}Client dashboard{% endblock %}
{% block page_title %}Client support{% endblock %}

{% block dashboard_content %}
<section class="dashboard-card">
    <div class="dashboard-card__header">
        <h2 class="dashboard-card__title">Client support</h2>
        <p class="dashboard-card__subtitle">
            Send a message to your coach about training, access, or technical issues.
        </p>
    </div>

    <form method="post" class="form">
        {% csrf_token %}

        <div class="form-field">
            <label for="support_subject">Subject</label>
            <input
                id="support_subject"
                name="subject"
                type="text"
                required
            >
        </div>

        <div class="form-field">
            <label for="support_message">Message</label>
            <textarea
                id="support_message"
                name="message"
                rows="5"
                required
            ></textarea>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-secondary">
                Send to coach
            </button>
        </div>
    </form>

</section>

<section class="dashboard-card dashboard-card--wide">
    <header class="card-header">
        <h2 class="card-title">Your tickets</h2>
        <p class="card-subtitle">
            View replies from your coach and track your requests.
        </p>
    </header>

    <div class="dashboard-table-wrapper">
        <table class="dashboard-table">
            <thead>
                <tr>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Last updated</th>
                    <th class="action-cell">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                <tr>
                    <td>{{ ticket.subject }}</td>
                    <td>
                        <span class="status-pill status-pill--{{ ticket.status }}">
                            {{ ticket.get_status_display }}
                        </span>
                    </td>
                    <td>{{ ticket.updated_at|date:"d M Y H:i" }}</td>
                    <td class="action-cell">
                        <a
                            class="text-link"
                            href="{% url 'accounts:client_support_ticket_detail' ticket.id %}"
                        >
                            View
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">
                        No support tickets yet. Send a message above to create one.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
