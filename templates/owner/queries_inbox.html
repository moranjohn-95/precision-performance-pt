{% extends "dashboard_base.html" %}
{% load static %}

{% block sidebar_title %}Owner Menu{% endblock %}

{% block sidebar_menu %}
    {# Owner-branded sidebar for queries inbox #}
    {% include "owner/_sidebar.html" %}
{% endblock %}

{% block page_eyebrow %}Owner dashboard{% endblock %}
{% block page_title %}Queries{% endblock %}
{% block page_subtitle %}
    Contact queries submitted via the Contact us form.
{% endblock %}

{% block dashboard_content %}
<section class="dashboard-card dashboard-card--wide">
    <header class="card-header">
        <h2 class="card-title">Queries</h2>
        <p class="card-subtitle">
            View contact submissions from clients and leads.
        </p>
    </header>

    <div class="card-body">
        <form method="get" class="table-filter">
            <label for="status">Status</label>
            <select id="status" name="status" onchange="this.form.submit()">
                <option value="all" {% if selected_status == "all" %}selected{% endif %}>
                    All
                </option>
                <option value="new" {% if selected_status == "new" %}selected{% endif %}>
                    New
                </option>
                <option value="in_progress"
                    {% if selected_status == "in_progress" %}selected{% endif %}>
                    In progress
                </option>
                <option value="closed" {% if selected_status == "closed" %}selected{% endif %}>
                    Closed
                </option>
            </select>
        </form>

        {% if queries %}
            <div class="dashboard-table-wrapper">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Submitted</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Assigned</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for query in queries %}
                            <tr>
                                <td>{{ query.created_at|date:"d M Y" }}</td>
                                <td>{{ query.first_name }} {{ query.last_name }}</td>
                                <td>{{ query.email }}</td>
                                <td>
                                    <span class="status-pill">
                                        {{ query.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    {{ query.assigned_trainer.get_full_name|default:query.assigned_trainer|default:"—" }}
                                </td>
                                <td>
                                    <a class="btn-link"
                                       href="{% url 'accounts:owner_query_detail' query.id %}">
                                        View
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No queries to display.</p>
        {% endif %}
    </div>
</section>

{# Second section: queries assigned to the current owner #}
<section class="dashboard-card dashboard-card--wide">
    <header class="card-header">
        <h2 class="card-title">My Queries</h2>
        <p class="card-subtitle">Queries assigned to you.</p>
    </header>

    <div class="card-body">
        {% if my_queries %}
            <div class="dashboard-table-wrapper">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Submitted</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Assigned</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for query in my_queries %}
                            <tr>
                                <td>{{ query.created_at|date:"d M Y" }}</td>
                                <td>{{ query.first_name }} {{ query.last_name }}</td>
                                <td>{{ query.email }}</td>
                                <td>
                                    <span class="status-pill">
                                        {{ query.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    {{ query.assigned_trainer.get_full_name|default:query.assigned_trainer|default:"—" }}
                                </td>
                                <td>
                                    <a class="btn-link"
                                       href="{% url 'accounts:owner_query_detail' query.id %}">
                                        View
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No queries assigned to you yet.</p>
        {% endif %}
    </div>
</section>
{% endblock %}
