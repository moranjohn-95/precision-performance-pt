{% extends "dashboard_base.html" %}
{% load static %}

{% block sidebar_title %}Owner Menu{% endblock %}

{% block sidebar_menu %}
    {# Owner-branded sidebar for query detail #}
    {% include "owner/_sidebar.html" %}
{% endblock %}

{% block page_eyebrow %}Owner dashboard{% endblock %}
{% block page_title %}Query detail{% endblock %}
{% block page_subtitle %}
{# Subtitle removed for brevity #}
{% endblock %}

{% block dashboard_content %}
<section class="page-actions">
    <a class="btn btn-secondary" href="{% url 'accounts:owner_queries' %}">
        Back to queries
    </a>
</section>

<section class="dashboard-card dashboard-card--wide">
    <header class="card-header">
        <h2 class="card-title">Query summary</h2>
    </header>

    <div class="card-body">
        <div class="dashboard-table-wrapper">
            <table class="dashboard-table">
                <tbody>
                    <tr>
                        <th scope="row">Submitted</th>
                        <td>{{ query.created_at|date:"d M Y, H:i" }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Name</th>
                        <td>{{ query.first_name }} {{ query.last_name }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Email</th>
                        <td>{{ query.email }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Phone</th>
                        <td>{{ query.phone|default:"—" }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Coaching option</th>
                        <td>{{ query.get_coaching_option_display }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Preferred contact</th>
                        <td>{{ query.get_preferred_contact_method_display }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Consent</th>
                        <td>{% if query.contact_consent %}Yes{% else %}No{% endif %}</td>
                    </tr>
                    <tr>
                        <th scope="row">Status</th>
                        <td>{{ query.get_status_display }}</td>
                    </tr>
                    <tr>
                        <th scope="row">Assigned</th>
                        <td>
                            {{ query.assigned_trainer.get_full_name|default:query.assigned_trainer|default:"—" }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        {# Message block grouped for tighter heading + box spacing #}
        <div class="card-section query-message-block">
            <h3 class="query-message-title">Message:</h3>
            <div class="message-box">
                {% if query.message %}
                    {{ query.message|linebreaksbr }}
                {% else %}
                    <span class="text-muted">No message provided.</span>
                {% endif %}
            </div>
        </div>

        <form method="post" class="form">
            {% csrf_token %}
            <div class="form-row">
                <label for="assign_trainer"><strong>Assign to:</strong></label>
                <select name="assign_trainer" id="assign_trainer">
                    <option value="me"
                        {% if selected_assign == "me" %}selected{% endif %}>
                        Assign to me
                    </option>
                    {# Current user excluded; covered by 'Assign to me'. #}
                    {% for trainer in trainers %}
                        <option value="{{ trainer.id }}"
                            {% if selected_assign == trainer.id %}selected{% endif %}>
                            {{ trainer.get_full_name|default:trainer.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-row">
                <label for="status"><strong>Status:</strong></label>
                <select name="status" id="status">
                    {% for value, label in status_choices %}
                        <option value="{{ value }}"
                            {% if query.status == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-actions form-actions--spaced assign-actions-row">
                <button type="submit" class="btn-secondary">Save</button>
            </div>
        </form>
    </div>
</section>
{% endblock %}
